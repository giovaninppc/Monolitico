<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Monolitico</title> 

 
<!-- <video> tag, with the @controls attribute
     giving it the play/pause/seeker controls,
     and the @loop making it automatically loop. --> 
</head>
	<body>
		<canvas id=c></canvas>
		<canvas id=b></canvas>
		<video id=v width="300" height="150" controls="" loop="" autoplay=""> 
			<!-- I have two versions of the video encoded with
			     different codecs.  The browser will automatically
			     choose the first one it knows it can play. --> 
			<source src="video.mp4" type="video/mp4"> 
		</video> 

 
<style> 
#c {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    height: 100%;
}
#v {
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -180px 0 0 -240px;
    display:none;
}
	}
</style>
 	</body>
</html>


<script>

	var color='#'+Math.floor(Math.random()*16777215).toString(16);
	var colorR = Math.floor(Math.random()*256);          
	var colorG = Math.floor(Math.random()*256);          
	var colorB = Math.floor(Math.random()*256); 
	var alphaColor = 0.01;

	var speed = 20; // higher is slower

	function componentToHex(c) {
	    var hex = c.toString(16);
	    return hex.length == 1 ? "0" + hex : hex;
	}

	function rgbToHex(r, g, b) {
	    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
	}


	document.addEventListener('DOMContentLoaded', function(){

	    var v = document.getElementById('v');
	    var canvas = document.getElementById('c');
	    var context = canvas.getContext('2d');

	    var cw = Math.floor(canvas.clientWidth / 1);
	    var ch = Math.floor(canvas.clientHeight / 1);
	    canvas.width = cw;
	    canvas.height = ch;

	    
	    window.setInterval(function(){ // update colors every 1 second  

	    	//CHANGE THE RANDOM TO SOMETHING THAT ACTUALLY USES THE SENSOR DATA
	    	colorR = Math.floor(Math.random()*256);          
	    	colorG = Math.floor(Math.random()*256);          
	    	colorB = Math.floor(Math.random()*256);    

	    	color = rgbToHex(colorR,colorG,colorB)
	    }, 1000);

	    window.setInterval(function(){ // update playback speed and color alpha shenenigans every 3 seconds
	    	document.getElementById('v').playbackRate = Math.random() * 10
	    	alphaColor = (Math.floor(Math.random() * (5 - 1 + 1)) + 1)/100
	    }, 3000);




	    v.addEventListener('play', function(){
	        draw(this,context,cw,ch);
	    },false);

},false);


function fadeOutRectangle(c, x, y, w, h, r, g, b) {
	console.log("fadeOutRectangle");
    var steps = 50,
        dr = (r - previousR) / steps, // how much red should be added each time
        dg = (g - previousG) / steps, // green
        db = (b - previousR) / steps, // blue
        i = 0, // step counter
        interval = setInterval(function() {
            c.fillStyle = 'rgb(' + Math.round(r + dr * i) + ','
                                   + Math.round(g + dg * i) + ','
                                   + Math.round(b + db * i) + ')';
            c.globalAlpha = 0.1
            c.fillRect(x, y, w, h); // will redraw the area each time
            i++;
            if(i === steps) { // stop if done
                clearInterval(interval);
            }
        }, 20);
}

function draw(v,c,w,h) {
    if(v.paused || v.ended) return false;

    c.drawImage(v,0,0,w,h);

	c.fillStyle=color;
	c.globalAlpha = alphaColor
	c.fillRect(0,0,w,h);

    //fadeOutRectangle(c,0,0,w,h,colorR,colorG,colorB)

    //speed when the user shakes the monolith (in this case, higher speed value means slower transition)
    setTimeout(draw,speed,v,c,w,h);

 
}
</script>